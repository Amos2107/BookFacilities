<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Register</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body>
  <nav class="navbar navbar-expand-sm bg-dark navbar-dark">
    <div class="container-fluid">
      <a class="navbar-brand" href="/">Rental Facilities</a>
      <div class="collapse navbar-collapse">
        <ul class="navbar-nav ms-auto">
            <li class="nav-item"><a class="nav-link" href="/login">Login</a></li>
            <li class="nav-item"><a class="nav-link" href="/register">Register</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container mt-5" style="max-width: 500px;">
    <h2 class="text-center mb-4">Create a new account</h2>

    <% if (messages && messages.length > 0) { %>
      <div class="alert alert-danger">
        <% messages.forEach(function(message) { %>
          <p class="mb-0"><%= message %></p>
        <% }); %>
      </div>
    <% } %>

    <form method="POST" action="/register" class="card p-4 shadow">
      <div class="mb-3">
        <label for="username" class="form-label">Username</label>
        <input type="text" id="username" name="username" class="form-control" value="<%= formData?.username || '' %>" required />
      </div>

      <div class="mb-3">
        <label for="dob" class="form-label">Date of birth <i class="bi bi-question-circle" title="Your birth date helps us verify your age."></i></label>
        <div class="d-flex gap-2">
          <select id="dob-day" name="dob_day" class="form-select" required></select>
          
          <select id="dob-month" name="dob_month" class="form-select" required>
            <% const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec']; %>
            <% months.forEach((m, i) => { %>
              <option value="<%= i + 1 %>"><%= m %></option>
            <% }); %>
          </select>

          <select id="dob-year" name="dob_year" class="form-select" required></select>
        </div>
      </div>

      <div class="mb-3">
        <label class="form-label">Gender <i class="bi bi-question-circle" title="Select your gender."></i></label>
        <div class="d-flex gap-3">
          <div class="form-check">
            <input class="form-check-input" type="radio" name="gender" value="Female" required>
            <label class="form-check-label">Female</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="gender" value="Male">
            <label class="form-check-label">Male</label>
          </div>
        </div>
      </div>

      <div class="mb-3">
        <label for="email" class="form-label">Email</label>
        <input type="email" id="email" name="email" class="form-control" value="<%= formData?.email || '' %>" required />
      </div>

      <div class="mb-3">
        <label for="password" class="form-label">Password</label>
        <input type="password" id="password" name="password" class="form-control" required />
      </div>

      <div class="mb-3">
        <label for="address" class="form-label">Address</label>
        <input type="text" id="address" name="address" class="form-control" value="<%= formData?.address || '' %>" required />
      </div>

      <div class="mb-3">
        <label for="contact" class="form-label">Contact</label>
        <input type="text" id="contact" name="contact" class="form-control" value="<%= formData?.contact || '' %>" required />
      </div>

      <div class="d-grid">
        <button type="submit" class="btn btn-success">Register</button>
      </div>
    </form>

    <p class="text-center mt-3">Already have an account? <a href="/login">Login here</a></p>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    const daySelect = document.getElementById('dob-day');
    const monthSelect = document.getElementById('dob-month');
    const yearSelect = document.getElementById('dob-year');

    // Populate years
    const currentYear = new Date().getFullYear();
    for (let y = currentYear; y >= 1900; y--) {
      const opt = document.createElement('option');
      opt.value = y;
      opt.text = y;
      yearSelect.appendChild(opt);
    }

    // Update days based on month and year
    function updateDays() {
      const year = parseInt(yearSelect.value);
      const month = parseInt(monthSelect.value); // 1-indexed (Jan = 1)
      
      const daysInMonth = new Date(year, month, 0).getDate(); // Day 0 of next month = last day of this month

      daySelect.innerHTML = '';
      for (let d = 1; d <= daysInMonth; d++) {
        const opt = document.createElement('option');
        opt.value = d;
        opt.text = d;
        daySelect.appendChild(opt);
      }
    }

    // Attach listeners
    monthSelect.addEventListener('change', updateDays);
    yearSelect.addEventListener('change', updateDays);

    // Set initial values (today's date) and update
    window.addEventListener('DOMContentLoaded', () => {
      monthSelect.value = new Date().getMonth() + 1;
      yearSelect.value = new Date().getFullYear();
      updateDays();
      daySelect.value = new Date().getDate();
    });
  </script>
</body>
</html>
