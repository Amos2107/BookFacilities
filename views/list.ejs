<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <title>Time Slots Management</title>
  <style>
    .available {
      background-color: #d4edda;
    }
    .unavailable {
      background-color: #f8d7da;
    }
    .time-slot-card {
      transition: transform 0.2s;
    }
    .time-slot-card:hover {
      transform: scale(1.02);
    }
  </style>
</head>
<body>
    <nav class="navbar navbar-expand-sm bg-dark navbar-dark">
      <div class="container-fluid">
        <a class="navbar-brand" href="/">Facility Booking System</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#collapsibleNavbar">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="collapsibleNavbar">
          <ul class="navbar-nav">
            <% if (!user) {%>
                <li class="nav-item">
                    <a class="nav-link" href="/register">Register</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/login">Login</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/timeslots">Time Slots</a>
            <% } else { %>
                <li class="nav-item">
                    <a class="nav-link" href="/timeslots">Time Slots</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/timeslots/available">Available Slots</a>
                </li>
                <% if (user.role === 'admin') { %>
                <li class="nav-item">
                    <a class="nav-link" href="/timeslots/add">Add Slot</a>
                </li>
                <% } %>
                <li class="nav-item">
                    <a class="nav-link" href="/logout">Logout</a>
                </li>
            <% } %>
          </ul>
        </div>
      </div>
    </nav>
 
    <div class="container mt-4">
        <% if (messages.error) { %>
            <div class="alert alert-danger alert-dismissible fade show">
                <%= messages.error %>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        <% } %>
        <% if (messages.success) { %>
            <div class="alert alert-success alert-dismissible fade show">
                <%= messages.success %>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        <% } %>
 
        <h2 class="mb-4">Time Slots Management</h2>
       
        <% if (user && user.role === 'admin') { %>
            <a href="/timeslots/add" class="btn btn-primary mb-3">Add New Time Slot</a>
        <% } %>
 
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>Facility</th>
                        <th>Date</th>
                        <th>Start Time</th>
                        <th>End Time</th>
                        <th>Status</th>
                        <% if (user && user.role === 'admin') { %>
                        <th>Actions</th>
                        <% } %>
                    </tr>
                </thead>
                <tbody>
                    <% timeSlots.forEach(slot => { %>
                    <tr class="<%= slot.is_available ? 'available' : 'unavailable' %>">
                        <td><%= slot.facility_name %></td>
                        <td><%= new Date(slot.date).toLocaleDateString() %></td>
                        <td><%= slot.start_time %></td>
                        <td><%= slot.end_time %></td>
                        <td>
                            <% if (slot.is_available) { %>
                                <span class="badge bg-success">Available</span>
                            <% } else { %>
                                <span class="badge bg-danger">Booked</span>
                            <% } %>
                        </td>
                        <% if (user && user.role === 'admin') { %>
                        <td>
                            <a href="/timeslots/edit/<%= slot.time_slot_id %>" class="btn btn-sm btn-warning">Edit</a>
                            <a href="/timeslots/delete/<%= slot.time_slot_id %>" class="btn btn-sm btn-danger"
                               onclick="return confirm('Are you sure you want to delete this time slot?')">Delete</a>
                        </td>
                        <% } %>
                    </tr>
                    <% }); %>
                </tbody>
            </table>
        </div>
 
        <% if (timeSlots.length === 0) { %>
            <div class="alert alert-info">No time slots found.</div>
        <% } %>
    </div>
    <!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Confirm Deletion</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete this time slot?</p>
        <p><strong>Facility:</strong> <span id="modalFacilityName"></span></p>
        <p><strong>Date:</strong> <span id="modalSlotDate"></span></p>
        <p><strong>Time:</strong> <span id="modalSlotTime"></span></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <a id="confirmDeleteBtn" href="#" class="btn btn-danger">Delete</a>
      </div>
    </div>
  </div>
</div>
 
<script>
  // Activate modal with slot data
  document.addEventListener('DOMContentLoaded', () => {
    const deleteModal = new bootstrap.Modal('#deleteModal');
    const modalFacility = document.getElementById('modalFacilityName');
    const modalDate = document.getElementById('modalSlotDate');
    const modalTime = document.getElementById('modalSlotTime');
    const confirmBtn = document.getElementById('confirmDeleteBtn');
 
    document.querySelectorAll('[data-bs-target="#deleteModal"]').forEach(btn => {
      btn.addEventListener('click', () => {
        const slot = JSON.parse(btn.dataset.slot);
        modalFacility.textContent = slot.facility_name;
        modalDate.textContent = new Date(slot.date).toLocaleDateString();
        modalTime.textContent = `${slot.start_time} - ${slot.end_time}`;
        confirmBtn.href = `/timeslots/delete/${slot.time_slot_id}`;
      });
    });
  });
</script>
</body>
</html>