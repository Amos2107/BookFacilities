<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <title>Edit Time Slot</title>
  <style>
    .form-container {
      max-width: 600px;
      margin: 0 auto;
      background-color: #f8f9fa;
      border-radius: 10px;
      padding: 30px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .time-inputs {
      display: flex;
      gap: 15px;
    }
    .time-inputs .form-group {
      flex: 1;
    }
    .is-available-toggle {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .form-header {
      border-bottom: 2px solid #dee2e6;
      padding-bottom: 15px;
      margin-bottom: 25px;
    }
    .current-values {
      background-color: #e9ecef;
      padding: 10px;
      border-radius: 5px;
      margin-bottom: 15px;
    }
  </style>
</head>
<body>
    <nav class="navbar navbar-expand-sm bg-dark navbar-dark">
      <div class="container-fluid">
        <a class="navbar-brand" href="/">Facility Booking System</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#collapsibleNavbar">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="collapsibleNavbar">
          <ul class="navbar-nav">
            <% if (!user) {%>
                <li class="nav-item">
                    <a class="nav-link" href="/register">Register</a>
                </li> 
                <li class="nav-item">
                    <a class="nav-link" href="/login">Login</a>
                </li> 
            <% } else { %>
                <li class="nav-item">
                    <a class="nav-link" href="/timeslots">All Slots</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/timeslots/available">Available Slots</a>
                </li>
                <% if (user.role === 'admin') { %>
                <li class="nav-item">
                    <a class="nav-link" href="/timeslots/add">Add Slot</a>
                </li>
                <% } %>
                <li class="nav-item">
                    <a class="nav-link active" href="#">Edit Slot</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/logout">Logout</a>
                </li> 
            <% } %>
          </ul>
        </div>
      </div>
    </nav>

    <div class="container py-4">
        <div class="form-container">
            <div class="form-header">
                <h2 class="mb-0">Edit Time Slot</h2>
                <p class="text-muted mb-0">Modify an existing time slot</p>
            </div>

            <% if (messages.error) { %>
                <div class="alert alert-danger alert-dismissible fade show">
                    <%= messages.error %>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            <% } %>

            <div class="current-values mb-4">
                <h6>Current Values:</h6>
                <p class="mb-1"><strong>Facility:</strong> <%= timeSlot.facility_name %></p>
                <p class="mb-1"><strong>Date:</strong> <%= new Date(timeSlot.date).toLocaleDateString() %></p>
                <p class="mb-1"><strong>Time:</strong> <%= timeSlot.start_time %> - <%= timeSlot.end_time %></p>
                <p class="mb-0"><strong>Status:</strong> 
                    <% if (timeSlot.is_available) { %>
                        <span class="badge bg-success">Available</span>
                    <% } else { %>
                        <span class="badge bg-danger">Booked</span>
                    <% } %>
                </p>
            </div>

            <form method="POST" action="/timeslots/edit/<%= timeSlot.time_slot_id %>">
                <div class="mb-3">
                    <label for="facilities_id" class="form-label">Facility</label>
                    <select class="form-select" id="facilities_id" name="facilities_id" required>
                        <% facilities.forEach(facility => { %>
                            <option value="<%= facility.facilities_id %>"
                                <%= facilities.facilities_id == timeSlot.facilities_id ? 'selected' : '' %>>
                                <%= facilities.facilities_name %>
                            </option>
                        <% }); %>
                    </select>
                </div>

                <div class="mb-3">
                    <label for="date" class="form-label">Date</label>
                    <input type="date" class="form-control" id="date" name="date" required
                           value="<%= new Date(timeSlot.date).toISOString().split('T')[0] %>">
                </div>

                <div class="mb-3 time-inputs">
                    <div class="form-group">
                        <label for="start_time" class="form-label">Start Time</label>
                        <input type="time" class="form-control" id="start_time" name="start_time" 
                               value="<%= timeSlot.start_time %>" step="900" required>
                    </div>
                    <div class="form-group">
                        <label for="end_time" class="form-label">End Time</label>
                        <input type="time" class="form-control" id="end_time" name="end_time" 
                               value="<%= timeSlot.end_time %>" step="900" required>
                    </div>
                </div>

                <div class="mb-4">
                    <div class="form-check form-switch is-available-toggle">
                        <input class="form-check-input" type="checkbox" id="is_available" 
                               name="is_available" <%= timeSlot.is_available ? 'checked' : '' %>
                               style="width: 3em; height: 1.5em;">
                        <label class="form-check-label" for="is_available">Make this slot available for booking</label>
                    </div>
                </div>

                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                    <a href="/timeslots" class="btn btn-outline-secondary me-md-2">Cancel</a>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Time validation
        document.addEventListener('DOMContentLoaded', function() {
            const startTimeInput = document.getElementById('start_time');
            const endTimeInput = document.getElementById('end_time');
            
            startTimeInput.addEventListener('change', function() {
                endTimeInput.min = this.value;
                if (endTimeInput.value < this.value) {
                    endTimeInput.value = this.value;
                }
            });
        });
    </script>
</body>
</html>